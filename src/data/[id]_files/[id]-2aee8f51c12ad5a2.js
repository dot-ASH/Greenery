(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2580],{68376:function(e,t,n){"use strict";n.d(t,{dU:function(){return i.dU},mM:function(){return r.ZP},uW:function(){return i.uW}});var r=n(32062),i=n(90409)},51324:function(e,t,n){"use strict";n.r(t);var r=n(55732),i=n(90849),o=n(11246),a=n(34707),c=n.n(a),s=n(85945),l=n(27378),d=n(79894),u=n.n(d),f=n(86677),b=n(43659),m=n(98784),p=n(94269),h=n(90907),v=n(11597),y=n(88671),g=n(65961),w=n(45355),j=n(36802),x=n(30630),S=n(41532),k=n(81228),N=n(68376),O=n(63840),C=n(47510),D=n(54782),E=n(24246);function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Z=function(){var e=(0,f.useRouter)(),t=(0,D.Fg)().isDarkMode,n=(0,j.UO)(),i=n.id,a=n.ref,d=(0,w.x3)({arrayKeys:["filter","sort"]}),b=(0,o.Z)(d,2),T=(b[0],b[1]),Z=(0,C.d2)().project,_=(0,s.NL)(),A=(0,w.oR)(),I=A.meta,z=A.ui,L=(0,l.useState)(),q=L[0],F=L[1],K=(0,l.useState)(!1),M=K[0],Q=K[1],R=(0,l.useState)(!1),U=R[0],W=R[1],B=(0,l.useState)(!1),J=B[0],V=B[1],X=(0,l.useState)(),G=X[0],H=X[1],Y=(0,l.useState)(),$=Y[0],ee=Y[1],te=(0,l.useState)(),ne=te[0],re=te[1],ie=(0,l.useState)(),oe=ie[0],ae=ie[1],ce=(0,l.useState)(),se=ce[0],le=ce[1],de=(0,l.useState)(),ue=de[0],fe=de[1],be=(0,l.useState)(),me=be[0],pe=be[1],he=(0,l.useState)(),ve=he[0],ye=he[1],ge=I.tables.list(),we=I.views.list(),je=I.materializedViews.list(),xe=I.foreignTables.list(),Se=(0,m.isNaN)(Number(i))?void 0:ge.concat(we).concat(je).concat(xe).find((function(e){return e.id===Number(i)}));(0,l.useEffect)((function(){Se&&"schema"in Se&&F(Se.schema)}),[null===Se||void 0===Se?void 0:Se.name]);var ke=function(e){T((function(t){var n,r,i=null!==(n=null===t||void 0===t?void 0:t.filter)&&void 0!==n?n:[],a=null!==(r=null===t||void 0===t?void 0:t.sort)&&void 0!==r?r:[];return P(P({},t),{},{filter:i.filter((function(t){var n=t.split(":");if((0,o.Z)(n,1)[0]!==e)return t})),sort:a.filter((function(t){var n=t.split(":");if((0,o.Z)(n,1)[0]!==e)return t}))})}))},Ne=function(){var e=(0,r.Z)(c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,void 0!==G){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,I.columns.del(G.id,J);case 5:if(!(t=e.sent).error){e.next=8;break}throw t.error;case 8:return ke(G.name),z.setNotification({category:"success",message:'Successfully deleted column "'.concat(G.name,'"')}),_.invalidateQueries(S.M.query(null===Z||void 0===Z?void 0:Z.ref,["foreign-key-constraints"])),e.next=13,Promise.all([I.tables.loadById(G.table_id),_.invalidateQueries(S.M.query(null===Z||void 0===Z?void 0:Z.ref,[Se.schema,Se.name])),_.invalidateQueries(S.M.query(null===Z||void 0===Z?void 0:Z.ref,["table-definition",Se.schema,Se.name]))]);case 13:if(!q){e.next=16;break}return e.next=16,I.views.loadBySchema(q);case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),z.setNotification({category:"error",message:"Failed to delete ".concat(G.name,": ").concat(e.t0.message)});case 21:return e.prev=21,Q(!1),H(void 0),e.finish(21);case 25:case"end":return e.stop()}}),e,null,[[0,18,21,25]])})));return function(){return e.apply(this,arguments)}}(),Oe=function(){var t=(0,r.Z)(c().mark((function t(){var n,r;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,void 0!==$){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,I.tables.del($.id,J);case 5:if(!(n=t.sent).error){t.next=8;break}throw n.error;case 8:return r=I.tables.list((function(e){return e.schema===q})),t.next=11,_.invalidateQueries(x.C.list(a));case 11:if(r.length>0?e.push("/project/".concat(a,"/editor/").concat(r[0].id)):e.push("/project/".concat(a,"/editor/")),z.setNotification({category:"success",message:'Successfully deleted table "'.concat($.name,'"')}),!q){t.next=16;break}return t.next=16,I.views.loadBySchema(q);case 16:t.next=21;break;case 18:t.prev=18,t.t0=t.catch(0),z.setNotification({error:t.t0,category:"error",message:"Failed to delete ".concat(null===$||void 0===$?void 0:$.name,": ").concat(t.t0.message)});case 21:return t.prev=21,Q(!1),ee(void 0),t.finish(21);case 25:case"end":return t.stop()}}),t,null,[[0,18,21,25]])})));return function(){return t.apply(this,arguments)}}();return(0,E.jsxs)(k.lz,{selectedSchema:q,selectedTable:null===Se||void 0===Se?void 0:Se.name,onSelectSchema:F,onAddTable:function(){re("table"),W(!1),fe(void 0)},onEditTable:function(e){re("table"),W(!1);var t=I.tables.byId(e.id);fe(t)},onDeleteTable:function(e){Q(!0);var t=I.tables.byId(e.id);ee(t),V(!1)},onDuplicateTable:function(e){re("table"),W(!0);var t=I.tables.byId(e.id);fe(t)},children:[(0,E.jsx)(N.mM,{selectedSchema:q,selectedTable:Se,sidePanelKey:ne,isDuplicating:U,selectedRowToEdit:oe,selectedColumnToEdit:se,selectedTableToEdit:ue,selectedValueForJsonEdit:me,selectedForeignKeyToEdit:ve,onAddRow:function(){re("row"),ae(void 0)},onEditRow:function(e){re("row"),ae(e)},onAddColumn:function(){re("column"),le(void 0)},onEditColumn:function(e){re("column"),le(e)},onDeleteColumn:function(e){Q(!0),H(e),V(!1)},onExpandJSONEditor:function(e,t){re("json"),pe({column:e,row:t,jsonString:JSON.stringify(t[e])||""})},onEditForeignKeyColumnValue:function(e){var t=e.foreignKey,n=e.row,r=e.column;re("foreign-row-selector"),ye({foreignKey:t,row:n,column:r})},onClosePanel:function(){re(void 0)},onImportData:function(){if(i){re("csv-import");var e=I.tables.byId(i);fe(e)}else console.error("Table ID not found")},theme:t?"dark":"light"}),(0,E.jsx)(O.Z,{danger:!0,size:"small",visible:M&&!(0,m.isUndefined)(G),header:'Confirm deletion of column "'.concat(null===G||void 0===G?void 0:G.name,'"'),buttonLabel:"Delete",buttonLoadingLabel:"Deleting",onSelectCancel:function(){Q(!1),H(void 0)},onSelectConfirm:Ne,children:(0,E.jsx)(p.C.Content,{children:(0,E.jsxs)("div",{className:"py-4 space-y-4",children:[(0,E.jsx)("p",{className:"text-sm text-scale-1100",children:"Are you sure you want to delete the selected column? This action cannot be undone."}),(0,E.jsx)(h.Z,{label:"Drop column with cascade?",description:"Deletes the column and its dependent objects",checked:J,onChange:function(){return V(!J)}}),J&&(0,E.jsxs)(v.Z,{withIcon:!0,variant:"warning",title:"Warning: Dropping with cascade may result in unintended consequences",children:[(0,E.jsx)("p",{className:"mb-4",children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,E.jsx)(u(),{href:"https://www.postgresql.org/docs/current/ddl-depend.html",children:(0,E.jsx)("a",{target:"_blank",rel:"noreferrer",children:(0,E.jsx)(y.z,{size:"tiny",type:"default",icon:(0,E.jsx)(g.Z,{}),children:"About dependency tracking"})})})]})]})})}),(0,E.jsx)(O.Z,{danger:!0,size:"small",visible:M&&!(0,m.isUndefined)($),header:(0,E.jsx)("span",{className:"break-words",children:'Confirm deletion of table "'.concat(null===$||void 0===$?void 0:$.name,'"')}),buttonLabel:"Delete",buttonLoadingLabel:"Deleting",onSelectCancel:function(){Q(!1),ee(void 0)},onSelectConfirm:Oe,children:(0,E.jsx)(p.C.Content,{children:(0,E.jsxs)("div",{className:"py-4 space-y-4",children:[(0,E.jsx)("p",{className:"text-sm text-scale-1100",children:"Are you sure you want to delete the selected table? This action cannot be undone."}),(0,E.jsx)(h.Z,{label:"Drop table with cascade?",description:"Deletes the table and its dependent objects",checked:J,onChange:function(){return V(!J)}}),J&&(0,E.jsxs)(v.Z,{withIcon:!0,variant:"warning",title:"Warning: Dropping with cascade may result in unintended consequences",children:[(0,E.jsx)("p",{className:"mb-4",children:"All dependent objects will be removed, as will any objects that depend on them, recursively."}),(0,E.jsx)(u(),{href:"https://www.postgresql.org/docs/current/ddl-depend.html",children:(0,E.jsx)("a",{target:"_blank",rel:"noreferrer",children:(0,E.jsx)(y.z,{size:"tiny",type:"default",icon:(0,E.jsx)(g.Z,{}),children:"About dependency tracking"})})})]})]})})})]})};Z.getLayout=function(e){return(0,E.jsx)(C.C,{children:e})},t.default=(0,w.QO)((0,b.Pi)(Z))},25570:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/editor/[id]",function(){return n(51324)}])}},function(e){e.O(0,[8143,7930,5232,9950,2367,2621,4633,6226,7606,1493,5074,6417,6400,9128,3844,113,4758,3324,2062,5306,9774,2888,179],(function(){return t=25570,e(e.s=t);var t}));var t=e.O();_N_E=t}]);
//# sourceMappingURL=[id]-2aee8f51c12ad5a2.js.map