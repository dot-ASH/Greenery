"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[113],{30113:function(e,s,t){t.d(s,{dF:function(){return W},AR:function(){return ee},V8:function(){return H},du:function(){return v}});var a=t(55732),r=t(34707),n=t.n(r),i=t(79894),c=t.n(i),l=t(43659),o=t(27378),d=t(64116),u=t(88671),x=t(65961),m=t(68043),p=t(45355),h=t(36802),j=t(20796),y=t(54782),f=t(24246),v=(0,l.Pi)((function(){var e=(0,p.oR)(),s=e.meta,t=e.ui,r=(0,h.UO)().ref,i=(0,y.Fg)().isDarkMode,l=(0,o.useState)(!1),v=l[0],b=l[1],N=(0,p.Xo)(m.KA.TENANT_SQL_ADMIN_WRITE,"extensions"),g=s.extensions.byId("supabase_vault"),k=void 0===g,w=function(){var e=(0,a.Z)(n().mark((function e(){var a,r,i,c,l,o;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==g){e.next=2;break}return e.abrupt("return");case 2:return b(!0),e.next=5,s.query("create schema if not exists ".concat(null!==(a=g.schema)&&void 0!==a?a:"vault",";"));case 5:if(i=e.sent,!(c=i.error)){e.next=10;break}return b(!1),e.abrupt("return",t.setNotification({error:c,category:"error",message:"Failed to create schema: ".concat(c.message)}));case 10:return e.next=12,s.extensions.create({schema:null!==(r=g.schema)&&void 0!==r?r:"vault",name:g.name,version:g.default_version,cascade:!0});case 12:l=e.sent,(o=l.error)?(t.setNotification({error:o,category:"error",message:"Failed to enable Vault for your project: ".concat(o.message)}),b(!1)):t.setNotification({category:"success",message:"Vault is now enabled for your project!"});case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,f.jsx)("div",{children:(0,f.jsx)("div",{className:"px-12 py-12 w-full bg-white dark:bg-scale-200 border border-scale-500 rounded bg-no-repeat",style:{backgroundSize:k?"50%":"40%",backgroundPosition:"100% 24%",backgroundImage:'url("'.concat(j.GW,i?'/img/vault-dark.png")':'/img/vault-light.png")')},children:(0,f.jsxs)("div",{className:"w-3/5 space-y-8",children:[(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)("h4",{className:"text-lg",children:"Enable Vault today"}),(0,f.jsx)("p",{className:"text-sm text-scale-1100",children:"Supabase Vault is a Postgres extension for managing secrets and encryption inside your database without leaking any sensitive information."})]}),k?(0,f.jsxs)("div",{className:"space-y-4",children:[(0,f.jsxs)("div",{className:"rounded border border-scale-500 px-4 py-2 flex items-center justify-between",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("p",{className:"text-scale-1100 text-sm",children:"Vault is not available for this project yet."}),(0,f.jsx)("p",{className:"text-scale-1000 text-sm",children:"Do reach out to us if you're interested!"})]}),(0,f.jsx)("div",{children:(0,f.jsx)(c(),{href:"/support/new?ref=".concat(r,"&category=sales&subject=Request%20for%20access%20to%20vault"),children:(0,f.jsx)("a",{target:"_blank",rel:"noreferrer",children:(0,f.jsx)(u.z,{type:"primary",children:"Contact us"})})})})]}),(0,f.jsx)("div",{className:"flex items-center space-x-2 my-1 ml-[1px]",children:(0,f.jsx)(c(),{href:"https://github.com/supabase/vault",children:(0,f.jsx)("a",{target:"_blank",rel:"noreferrer",children:(0,f.jsx)(u.z,{type:"default",icon:(0,f.jsx)(x.Z,{}),children:"About Vault"})})})})]}):(0,f.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,f.jsx)(c(),{href:"https://github.com/supabase/vault",children:(0,f.jsx)("a",{target:"_blank",rel:"noreferrer",children:(0,f.jsx)(u.z,{type:"default",icon:(0,f.jsx)(x.Z,{}),children:"About Vault"})})}),(0,f.jsxs)(d.fC,{delayDuration:0,children:[(0,f.jsx)(d.xz,{children:(0,f.jsx)(u.z,{type:"primary",loading:v,disabled:k||v||!N,onClick:function(){return w()},children:"Enable Vault"})}),!N&&(0,f.jsx)(d.h_,{children:(0,f.jsxs)(d.VY,{side:"bottom",children:[(0,f.jsx)(d.Eh,{className:"radix-tooltip-arrow"}),(0,f.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,f.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to enable Vault for this project"})})]})})]})]})]})})})})),b=t(79305),N=t(3648),g=t(1296),k=t(70946),w=t(58728),C=t(14971),S=t(27693),Z=t.n(S),z=t(85742),_=t(44292),O=t(51669),D=t(2674),E=t(56744),I=t(44315),V=t(43555),F=function(e){var s,t=e.secret,r=e.onSelectEdit,i=e.onSelectRemove,l=(0,p.oR)().vault,x=(0,h.UO)().ref,j=(0,o.useState)(!1),y=j[0],v=j[1],b=(0,o.useState)(),g=b[0],k=b[1],w=null!==(s=null===t||void 0===t?void 0:t.name)&&void 0!==s?s:"No name provided",S=(0,p.Xo)(m.KA.TENANT_SQL_ADMIN_WRITE,"tables"),F=function(){var e=(0,a.Z)(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v(!0),void 0!==g){e.next=14;break}if(e.t0=k,void 0===t.decryptedSecret){e.next=7;break}e.t1=t.decryptedSecret,e.next=10;break;case 7:return e.next=9,l.fetchSecretValue(t.id);case 9:e.t1=e.sent;case 10:e.t2=e.t1,(0,e.t0)(e.t2),e.next=15;break;case 14:k(void 0);case 15:v(!1);case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,f.jsxs)("div",{className:"px-6 py-4 flex items-center space-x-4",children:[(0,f.jsxs)("div",{className:"space-y-1 min-w-[35%] max-w-[35%]",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("p",{className:"text-sm text-scale-1200",title:w,children:w}),void 0!==t.description&&(0,f.jsx)("p",{className:"text-sm text-scale-1100",title:t.description,children:t.description})]}),(0,f.jsxs)("div",{className:"flex items-center space-x-2 group",children:[(0,f.jsx)(z.Z,{size:14,strokeWidth:2,className:"text-scale-1000 transition group-hover:text-brand-900"}),(0,f.jsx)(c(),{href:"/project/".concat(x,"/settings/vault/keys?id=").concat(t.key_id),children:(0,f.jsx)("a",{className:"text-scale-1100 font-mono text-xs cursor-pointer transition group-hover:text-brand-900",title:t.key_id,children:t.key_id})})]})]}),(0,f.jsxs)("div",{className:"flex items-center space-x-2 w-[40%]",children:[(0,f.jsx)(u.z,{type:"text",className:"px-1.5",icon:y?(0,f.jsx)(C.Z,{className:"animate-spin",size:16,strokeWidth:1.5}):void 0===g?(0,f.jsx)(_.Z,{size:16,strokeWidth:1.5}):(0,f.jsx)(O.Z,{size:16,strokeWidth:1.5}),onClick:function(){return F()}}),(0,f.jsx)("div",{className:"flex-grow",children:void 0===g?(0,f.jsx)("p",{className:"text-sm font-mono",children:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"}):(0,f.jsx)(N.Z,{copy:!0,size:"small",className:"font-mono",value:g})})]}),(0,f.jsxs)("div",{className:"flex items-center justify-end w-[25%] space-x-4",children:[(0,f.jsxs)("p",{className:"text-sm text-scale-1100",children:[t.updated_at===t.created_at?"Added":"Updated"," on"," ",Z()(t.updated_at).format("MMM D, YYYY")]}),(0,f.jsx)(D.ZP,{side:"bottom",className:"w-[120px]",overlay:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)(d.fC,{delayDuration:0,children:[(0,f.jsx)(d.xz,{children:(0,f.jsx)(D.ZP.Item,{icon:(0,f.jsx)(E.Z,{size:"tiny"}),disabled:!S,onClick:function(){return r(t)},children:"Edit"})}),!S&&(0,f.jsx)(d.h_,{children:(0,f.jsxs)(d.VY,{side:"bottom",children:[(0,f.jsx)(d.Eh,{className:"radix-tooltip-arrow"}),(0,f.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,f.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to edit secrets"})})]})})]}),(0,f.jsxs)(d.fC,{delayDuration:0,children:[(0,f.jsx)(d.xz,{children:(0,f.jsx)(D.ZP.Item,{disabled:!S,icon:(0,f.jsx)(I.Z,{stroke:"red",size:"tiny"}),onClick:function(){return i(t)},children:"Delete"})}),!S&&(0,f.jsx)(d.h_,{children:(0,f.jsxs)(d.VY,{side:"bottom",children:[(0,f.jsx)(d.Eh,{className:"radix-tooltip-arrow"}),(0,f.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,f.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to delete secrets"})})]})})]})]}),children:(0,f.jsx)(u.z,{asChild:!0,type:"text",className:"px-1",icon:(0,f.jsx)(V.Z,{}),children:(0,f.jsx)("span",{})})})]})]})},A=t(90849),K=t(98784),P=t(94269),Y=t(77758),T=t(87474),W=function(e){var s=e.id,t=void 0===s?"keyId":s,a=e.nameId,r=void 0===a?"keyName":a,n=e.label,i=void 0===n?"Encryption key":n,c=e.labelOptional,l=e.selectedKeyId,o=e.error,d=e.onSelectKey,u=void 0===d?function(){}:d,x=e.onUpdateDescription,m=void 0===x?function(){}:x,h=(0,p.oR)().vault.listKeys();return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)(w.Z,{id:t,label:i,size:"small",defaultValue:l,value:l,labelOptional:c,onChange:u,children:[(0,f.jsx)(w.Z.Option,{id:"create-new",value:"create-new",label:"Create a new Encryption Key",addOnBefore:function(){return(0,f.jsx)(T.Z,{size:16,strokeWidth:1.5})},children:"Create a new Encryption Key"},"create-new"),h.length>0&&(0,f.jsx)(P.C.Separator,{}),h.map((function(e){return(0,f.jsx)(w.Z.Option,{label:e.name,value:e.id,children:(0,f.jsxs)("div",{className:"space-y-1",children:[(0,f.jsx)("p",{children:e.name||"No name provided"}),(0,f.jsxs)("p",{className:"text-xs",children:["ID: ",(0,f.jsx)("span",{className:"font-mono",children:e.id})]})]})},e.id)}))]}),"create-new"===l&&(0,f.jsx)(N.Z,{id:r,label:"Name",error:o,onChange:function(e){return m(e.target.value)}})]})},L=t(51452);function R(e,s){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);s&&(a=a.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),t.push.apply(t,a)}return t}function M(e){for(var s=1;s<arguments.length;s++){var t=null!=arguments[s]?arguments[s]:{};s%2?R(Object(t),!0).forEach((function(s){(0,A.Z)(e,s,t[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):R(Object(t)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(t,s))}))}return e}var U=function(e){var s,t,r,i=e.selectedSecret,c=e.onClose,l=(0,p.oR)(),d=l.ui,x=l.vault,m=(0,o.useState)(),h=m[0],j=m[1],y=(0,o.useState)(!1),v=y[0],b=y[1],g=(0,o.useState)(!1),k=g[0],w=g[1],C={name:null!==(s=null===i||void 0===i?void 0:i.name)&&void 0!==s?s:"",description:null!==(t=null===i||void 0===i?void 0:i.description)&&void 0!==t?t:"",secret:null!==(r=null===i||void 0===i?void 0:i.decryptedSecret)&&void 0!==r?r:""};(0,o.useEffect)((function(){void 0!==i&&(b(!1),j(i.key_id))}),[i]);var S=function(){var e=(0,a.Z)(n().mark((function e(s,t){var a,r,l,o,u;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.setSubmitting,r={},s.name!==i.name&&(r.name=s.name),s.description!==i.description&&(r.description=s.description),h===i.key_id){e.next=16;break}if(l=h,"create-new"!==s.keyId){e.next=15;break}return e.next=9,x.addKey(s.keyName||void 0);case 9:if(!(o=e.sent).error){e.next=14;break}return e.abrupt("return",d.setNotification({error:o.error,category:"error",message:"Failed to create new key: ".concat(o.error.message)}));case 14:l=o[0].id;case 15:r.key_id=l;case 16:if(r.secret=s.secret,(0,K.isEmpty)(r)){e.next=23;break}return a(!0),e.next=21,x.updateSecret(i.id,r);case 21:(u=e.sent).error?(d.setNotification({error:u.error,category:"error",message:"Failed to update secret: ".concat(u.error.message)}),a(!1)):(d.setNotification({category:"success",message:"Successfully updated secret"}),a(!1),c());case 23:case"end":return e.stop()}}),e)})));return function(s,t){return e.apply(this,arguments)}}();return(0,f.jsx)(P.C,{closable:!0,hideFooter:!0,size:"medium",visible:void 0!==i,onCancel:c,header:(0,f.jsx)("h5",{className:"text-sm text-scale-1200",children:"Edit secret"}),children:(0,f.jsx)(Y.Z,{id:"add-new-secret-form",initialValues:C,validate:function(e){var s={};return 0===e.name.length&&(s.name="Please provide a name for your secret"),0===e.secret.length&&(s.secret="Please enter your secret value"),s},validateOnBlur:!1,onSubmit:S,children:function(e){var s=e.isSubmitting,t=e.resetForm;(0,o.useEffect)((function(){void 0!==i&&void 0===i.decryptedSecret&&r()}),[i]);var r=function(){var e=(0,a.Z)(n().mark((function e(){var s;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==i){e.next=2;break}return e.abrupt("return");case 2:return w(!0),e.next=5,x.fetchSecretValue(i.id);case 5:s=e.sent,t({values:M(M({},C),{},{secret:s}),initialValues:M(M({},C),{},{secret:s})}),w(!1);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return k?(0,f.jsxs)("div",{className:"space-y-2 py-4 px-2",children:[(0,f.jsx)(L.Z,{}),(0,f.jsx)("div",{className:"w-3/4",children:(0,f.jsx)(L.Z,{})}),(0,f.jsx)("div",{className:"w-1/2",children:(0,f.jsx)(L.Z,{})})]}):(0,f.jsxs)("div",{className:"py-4",children:[(0,f.jsx)(P.C.Content,{children:(0,f.jsxs)("div",{className:"space-y-4 pb-4",children:[(0,f.jsx)(N.Z,{id:"name",label:"Name"}),(0,f.jsx)(N.Z,{id:"description",label:"Description",labelOptional:"Optional"}),(0,f.jsx)(N.Z,{id:"secret",type:v?"text":"password",label:"Secret value",actions:(0,f.jsx)("div",{className:"mr-1",children:(0,f.jsx)(u.z,{type:"default",icon:v?(0,f.jsx)(O.Z,{}):(0,f.jsx)(_.Z,{}),onClick:function(){return b(!v)}})})})]})}),(0,f.jsx)(P.C.Separator,{}),(0,f.jsx)(P.C.Content,{children:(0,f.jsx)("div",{className:"py-4 space-y-4",children:(0,f.jsx)(W,{id:"keyId",nameId:"keyName",label:"Select a key to encrypt your secret with",labelOptional:"Optional",selectedKeyId:h,onSelectKey:j})})}),(0,f.jsx)(P.C.Separator,{}),(0,f.jsx)(P.C.Content,{children:(0,f.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,f.jsx)(u.z,{type:"default",disabled:s,onClick:function(){return c()},children:"Cancel"}),(0,f.jsx)(u.z,{htmlType:"submit",disabled:s,loading:s,children:"Update secret"})]})})]})}})})},B=function(e){var s=e.selectedSecret,t=e.onClose,r=(0,p.oR)(),i=r.vault,c=r.ui,l=(0,o.useState)(!1),d=l[0],u=l[1],x=function(){var e=(0,a.Z)(n().mark((function e(){var a;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u(!0),e.next=3,i.deleteSecret(s.id);case 3:(a=e.sent).error?c.setNotification({error:a.error,category:"error",message:"Failed to delete secret: ".concat(a.error.message)}):(c.setNotification({category:"success",message:"Successfully deleted secret ".concat(s.name)}),t()),u(!1);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,f.jsx)(P.C,{closable:!0,size:"small",alignFooter:"right",visible:void 0!==s,onCancel:t,onConfirm:x,loading:d,header:(0,f.jsx)("h5",{className:"text-sm text-scale-1200",children:"Confirm to delete secret"}),children:(0,f.jsx)("div",{className:"py-4",children:(0,f.jsx)(P.C.Content,{children:(0,f.jsxs)("div",{className:"space-y-4",children:[(0,f.jsx)("p",{className:"text-sm",children:"The following secret will be permanently removed and cannot be recovered. Are you sure?"}),(0,f.jsxs)("div",{className:"space-y-1",children:[(0,f.jsx)("p",{className:"text-sm",children:null===s||void 0===s?void 0:s.description}),(0,f.jsxs)("p",{className:"text-sm text-scale-1100",children:["ID: ",(0,f.jsx)("span",{className:"font-mono",children:null===s||void 0===s?void 0:s.key_id})]})]})]})})})})},Q=t(29432),X=t(33114),q=function(e){var s=e.visible,t=e.onClose,r=(0,p.oR)(),i=r.vault,c=r.ui,l=(0,o.useState)(!1),d=l[0],x=l[1],m=(0,o.useState)(),h=m[0],j=m[1],y=i.listKeys();(0,o.useEffect)((function(){var e,t;s&&(x(!1),j(null!==(e=null===(t=y[0])||void 0===t?void 0:t.id)&&void 0!==e?e:"create-new"))}),[s]);var v=function(){var e=(0,a.Z)(n().mark((function e(s,a){var r,l,o,d;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=a.setSubmitting)(!0),l=h,"create-new"!==h){e.next=12;break}return e.next=6,i.addKey(s.keyName||void 0);case 6:if(!(o=e.sent).error){e.next=11;break}return e.abrupt("return",c.setNotification({error:o.error,category:"error",message:"Failed to create new key: ".concat(o.error.message)}));case 11:l=o[0].id;case 12:return e.next=14,i.addSecret({name:s.name,description:s.description,secret:s.secret,key_id:l});case 14:(d=e.sent).error?(c.setNotification({error:d.error,category:"error",message:"Failed to add secret ".concat(s.name,": ").concat(d.error.message)}),r(!1)):(c.setNotification({category:"success",message:"Successfully added new secret ".concat(s.name)}),t(),r(!1));case 16:case"end":return e.stop()}}),e)})));return function(s,t){return e.apply(this,arguments)}}();return(0,f.jsx)(P.C,{closable:!0,hideFooter:!0,size:"medium",visible:s,onCancel:t,header:(0,f.jsx)("h5",{className:"text-sm text-scale-1200",children:"Add new secret"}),children:(0,f.jsx)(Y.Z,{id:"add-new-secret-form",initialValues:{name:"",description:"",secret:"",keyId:"",keyName:""},validate:function(e){var s={};return 0===e.name.length&&(s.name="Please provide a name for your secret"),0===e.secret.length&&(s.secret="Please enter your secret value"),"create-new"===h&&0===e.keyName.length&&(s.keyName="Please provide a name for your new key"),s},validateOnBlur:!1,onSubmit:v,children:function(e){var s=e.isSubmitting;return(0,f.jsxs)("div",{className:"py-4",children:[(0,f.jsx)(P.C.Content,{children:(0,f.jsxs)("div",{className:"space-y-4 pb-4",children:[(0,f.jsx)(N.Z,{id:"name",label:"Name"}),(0,f.jsx)(N.Z,{id:"description",label:"Description",labelOptional:"Optional"}),(0,f.jsx)(N.Z,{id:"secret",type:d?"text":"password",label:"Secret value",actions:(0,f.jsx)("div",{className:"mr-1",children:(0,f.jsx)(u.z,{type:"default",icon:d?(0,f.jsx)(O.Z,{}):(0,f.jsx)(_.Z,{}),onClick:function(){return x(!d)}})})})]})}),(0,f.jsx)(P.C.Separator,{}),(0,f.jsx)(P.C.Content,{children:(0,f.jsxs)("div",{className:"py-4 space-y-4",children:[(0,f.jsx)(W,{id:"keyId",nameId:"keyName",label:"Select a key to encrypt your secret with",labelOptional:"Optional",selectedKeyId:h,onSelectKey:j}),(0,f.jsx)(X.Z,{icon:(0,f.jsx)(Q.Z,{size:18,strokeWidth:2}),url:"https://github.com/supabase/vault",urlLabel:"Vault documentation",title:"What is a key?",description:(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)("p",{children:"Keys are used to encrypt data inside your database, and every secret in the Vault is encrypted with a key."}),(0,f.jsx)("p",{children:"You may create different keys for different purposes, such as one for encrypting user data, and another for application data."})]})})]})}),(0,f.jsx)(P.C.Separator,{}),(0,f.jsx)(P.C.Content,{children:(0,f.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,f.jsx)(u.z,{type:"default",disabled:s,onClick:t,children:"Cancel"}),(0,f.jsx)(u.z,{htmlType:"submit",disabled:s,loading:s,children:"Add secret"})]})})]})}})})},G=t(92836),H=(0,l.Pi)((function(e){(0,b.Z)(e);var s=(0,p.oR)().vault,t=(0,h.UO)().search,a=(0,o.useState)(""),r=a[0],n=a[1],i=(0,o.useState)("updated_at"),l=i[0],j=i[1],y=(0,o.useState)(!1),v=y[0],S=y[1],Z=(0,o.useState)(),z=Z[0],_=Z[1],O=(0,o.useState)(),D=O[0],E=O[1],I=(0,p.Xo)(m.KA.TENANT_SQL_ADMIN_WRITE,"tables");(0,o.useEffect)((function(){void 0!==t&&n(t)}),[t]);var V=(r.length>0?s.listSecrets((function(e){var s;return(null!==(s=null===e||void 0===e?void 0:e.name)&&void 0!==s?s:"").toLowerCase().includes(r.toLowerCase())||e.key_id.toLowerCase().includes(r.toLowerCase())})):s.listSecrets()).sort((function(e,s){return"updated_at"===l?Number(new Date(e.updated_at))-Number(new Date(s.updated_at)):e[l]>s[l]?1:-1}));return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{className:"space-y-4",children:[(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,f.jsx)(N.Z,{className:"w-64",size:"small",placeholder:"Search by name or key ID",value:r,onChange:function(e){return n(e.target.value)},icon:(0,f.jsx)(g.Z,{strokeWidth:2,size:16}),actions:r.length>0?[(0,f.jsx)(u.z,{size:"tiny",type:"text",icon:(0,f.jsx)(k.Z,{}),className:"px-1",onClick:function(){return n("")}},"clear")]:[]}),(0,f.jsx)("div",{className:"w-32",children:(0,f.jsxs)(w.Z,{size:"small",value:l,onChange:j,children:[(0,f.jsx)(w.Z.Option,{id:"updated_at",className:"max-w-[180px]",value:"updated_at",label:"Sort by updated at",children:"Updated at"}),(0,f.jsx)(w.Z.Option,{id:"name",className:"max-w-[180px]",value:"name",label:"Sort by name",children:"Name"}),(0,f.jsx)(w.Z.Option,{id:"key_id",className:"max-w-[180px]",value:"key_id",label:"Sort by key ID",children:"Key ID"})]})})]}),(0,f.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,f.jsx)(c(),{href:"https://supabase.com/docs/guides/database/vault",children:(0,f.jsx)("a",{target:"_blank",rel:"noreferrer",children:(0,f.jsx)(u.z,{type:"default",icon:(0,f.jsx)(x.Z,{strokeWidth:1.5}),children:"Vault Documentation"})})}),(0,f.jsxs)(d.fC,{delayDuration:0,children:[(0,f.jsx)(d.xz,{children:(0,f.jsx)(u.z,{type:"primary",disabled:!I,onClick:function(){return S(!0)},children:"Add new secret"})}),!I&&(0,f.jsx)(d.h_,{children:(0,f.jsxs)(d.VY,{side:"bottom",children:[(0,f.jsx)(d.Eh,{className:"radix-tooltip-arrow"}),(0,f.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,f.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to add secrets"})})]})})]})]})]}),(0,f.jsx)("div",{className:"border border-scale-500 rounded",children:s.isLoaded?(0,f.jsxs)(f.Fragment,{children:[V.map((function(e,s){return(0,f.jsxs)(o.Fragment,{children:[(0,f.jsx)(F,{secret:e,onSelectEdit:_,onSelectRemove:E}),s!==V.length-1&&(0,f.jsx)(G.Z,{light:!0})]},"secret-".concat(s))})),0===V.length&&(0,f.jsx)(f.Fragment,{children:0===r.length?(0,f.jsxs)("div",{className:"px-6 py-6 space-y-1 flex flex-col items-center justify-center",children:[(0,f.jsx)("p",{className:"text-sm text-scale-1200",children:"No secrets added yet"}),(0,f.jsx)("p",{className:"text-sm text-scale-1100",children:"The Vault allows you to store sensitive information like API keys"})]}):(0,f.jsxs)("div",{className:"px-6 py-4 space-y-1",children:[(0,f.jsx)("p",{className:"text-sm text-scale-1200",children:"No results found"}),(0,f.jsxs)("p",{className:"text-sm text-scale-1100",children:['Your search for "',r,'" did not return any results']})]})})]}):(0,f.jsxs)("div",{className:"px-6 py-6 space-x-2 flex items-center justify-center",children:[(0,f.jsx)(C.Z,{className:"animate-spin text-scale-1100",size:16,strokeWidth:1.5}),(0,f.jsx)("p",{className:"text-sm text-scale-1200",children:"Loading secrets from the Vault"})]})})]}),(0,f.jsx)(U,{selectedSecret:z,onClose:function(){return _(void 0)}}),(0,f.jsx)(B,{selectedSecret:D,onClose:function(){return E(void 0)}}),(0,f.jsx)(q,{visible:v,onClose:function(){return S(!1)}})]})})),J=t(11597),$="No description provided",ee=(0,l.Pi)((function(e){var s;(0,b.Z)(e);var t=(0,p.oR)(),r=t.vault,i=t.ui,l=(0,h.UO)().id,j=(0,o.useState)(""),y=j[0],v=j[1],S=(0,o.useState)("created"),_=S[0],O=S[1],D=(0,o.useState)(!1),E=D[0],V=D[1],F=(0,o.useState)(),A=F[0],K=F[1],T=(0,o.useState)(!1),W=T[0],L=T[1],R=(0,p.Xo)(m.KA.TENANT_SQL_ADMIN_WRITE,"tables");(0,o.useEffect)((function(){void 0!==l&&v(l)}),[l]);var M=(y?r.listKeys((function(e){var s;return(null!==(s=null===e||void 0===e?void 0:e.name)&&void 0!==s?s:"").toLowerCase().includes(y.toLowerCase())||e.id.toLowerCase().includes(y.toLowerCase())})):r.listKeys()).sort((function(e,s){return"created"===_?Number(new Date(e.created))-Number(new Date(s.created)):e[_]>s[_]?1:-1})),U=function(){var e=(0,a.Z)(n().mark((function e(s,t){var a,c;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=t.setSubmitting)(!0),e.next=4,r.addKey(s.name);case 4:(c=e.sent).error?i.setNotification({error:c.error,category:"error",message:"Failed to add new key: ".concat(c.error.message)}):(i.setNotification({category:"success",message:"Successfully added new key"}),V(!1)),a(!1);case 7:case"end":return e.stop()}}),e)})));return function(s,t){return e.apply(this,arguments)}}(),B=function(){var e=(0,a.Z)(n().mark((function e(){var s;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(A){e.next=2;break}return e.abrupt("return");case 2:return L(!0),e.next=5,r.deleteKey(A.id);case 5:(s=e.sent).error?i.setNotification({error:s.error,category:"error",message:"Failed to delete encryption key: ".concat(s.error.message)}):(i.setNotification({category:"success",message:"Successfully deleted encryption key"}),K(void 0)),L(!1);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{className:"space-y-4",children:[(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,f.jsx)(N.Z,{className:"w-64 input-clear",size:"small",placeholder:"Search by name or ID",value:y,onChange:function(e){return v(e.target.value)},icon:(0,f.jsx)(g.Z,{strokeWidth:2,size:16}),actions:y.length>0?[(0,f.jsx)(u.z,{size:"tiny",type:"text",icon:(0,f.jsx)(k.Z,{}),className:"px-1",onClick:function(){return v("")}},"clear")]:[]}),(0,f.jsx)("div",{className:"w-32",children:(0,f.jsxs)(w.Z,{size:"small",value:_,onChange:O,children:[(0,f.jsx)(w.Z.Option,{id:"created",className:"max-w-[180px]",value:"created",label:"Sort by created at",children:"Created at"}),(0,f.jsx)(w.Z.Option,{id:"name",className:"max-w-[180px]",value:"name",label:"Sort by name",children:"Name"})]})})]}),(0,f.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,f.jsx)(c(),{href:"https://supabase.com/docs/guides/database/vault",children:(0,f.jsx)("a",{target:"_blank",rel:"noreferrer",children:(0,f.jsx)(u.z,{type:"default",icon:(0,f.jsx)(x.Z,{strokeWidth:1.5}),children:"Vault Documentation"})})}),(0,f.jsxs)(d.fC,{delayDuration:0,children:[(0,f.jsx)(d.xz,{children:(0,f.jsx)(u.z,{type:"primary",disabled:!R,onClick:function(){return V(!0)},children:"Add new key"})}),!R&&(0,f.jsx)(d.h_,{children:(0,f.jsxs)(d.VY,{side:"bottom",children:[(0,f.jsx)(d.Eh,{className:"radix-tooltip-arrow"}),(0,f.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,f.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to add keys"})})]})})]})]})]}),(0,f.jsx)("div",{className:"border border-scale-500 rounded",children:r.isLoaded?(0,f.jsxs)(f.Fragment,{children:[M.map((function(e,s){return(0,f.jsxs)(o.Fragment,{children:[(0,f.jsxs)("div",{className:"px-6 py-4 flex items-center space-x-4",children:[(0,f.jsx)(z.Z,{className:"text-scale-1100",strokeWidth:2}),(0,f.jsxs)("div",{className:"space-y-1 min-w-[70%] max-w-[70%]",children:[(0,f.jsx)("p",{className:"text-sm truncate text-scale-1200",title:e.name||$,children:e.name||$}),(0,f.jsxs)("p",{title:e.id,className:"text-xs text-scale-1100 font-bold truncate",children:["ID: ",(0,f.jsx)("span",{className:"font-mono",children:e.id})]})]}),(0,f.jsxs)("div",{className:"flex items-center justify-end w-[30%] space-x-4",children:[(0,f.jsxs)("p",{className:"text-sm text-scale-1100",children:["Added on ",Z()(e.created).format("MMM D, YYYY")]}),(0,f.jsxs)(d.fC,{delayDuration:0,children:[(0,f.jsx)(d.xz,{children:(0,f.jsx)(u.z,{type:"default",className:"py-2",icon:(0,f.jsx)(I.Z,{}),disabled:!R,onClick:function(){return K(e)}})}),!R&&(0,f.jsx)(d.h_,{children:(0,f.jsxs)(d.VY,{side:"bottom",children:[(0,f.jsx)(d.Eh,{className:"radix-tooltip-arrow"}),(0,f.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,f.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to delete keys"})})]})})]})]})]}),s!==M.length-1&&(0,f.jsx)(G.Z,{light:!0})]},e.key_id)})),0===M.length&&(0,f.jsx)(f.Fragment,{children:0===y.length?(0,f.jsxs)("div",{className:"px-6 py-6 space-y-1 flex flex-col items-center justify-center",children:[(0,f.jsx)("p",{className:"text-sm text-scale-1200",children:"No encryption keys added yet"}),(0,f.jsx)("p",{className:"text-sm text-scale-1100 text-center",children:"Encryption keys are created by the pgsodium extension and can be used to encrypt your columns and secrets"})]}):(0,f.jsxs)("div",{className:"px-6 py-4 space-y-1",children:[(0,f.jsx)("p",{className:"text-sm text-scale-1200",children:"No results found"}),(0,f.jsxs)("p",{className:"text-sm text-scale-1100",children:['Your search for "',y,'" did not return any results']})]})})]}):(0,f.jsxs)("div",{className:"px-6 py-6 space-x-2 flex items-center justify-center",children:[(0,f.jsx)(C.Z,{className:"animate-spin text-scale-1100",size:16,strokeWidth:1.5}),(0,f.jsx)("p",{className:"text-sm text-scale-1200",children:"Loading keys from the Vault"})]})})]}),(0,f.jsx)(P.C,{closable:!0,size:"medium",alignFooter:"right",visible:void 0!==A,onCancel:function(){return K(void 0)},onConfirm:B,loading:W,header:(0,f.jsx)("h5",{className:"text-sm text-scale-1200",children:"Confirm to delete key"}),children:(0,f.jsx)("div",{className:"py-4",children:(0,f.jsx)(P.C.Content,{children:(0,f.jsxs)("div",{className:"space-y-4",children:[(0,f.jsx)(J.Z,{withIcon:!0,variant:"warning",title:"Deleting a key that's in use will cause any secret or column which depends on it to be unusable.",children:"Do ensure that the key is not currently in use to prevent any issues."}),(0,f.jsx)("p",{className:"text-sm",children:"The following key will be permanently removed and cannot be recovered."}),(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)("p",{className:"text-sm text-scale-1200",children:null!==(s=null===A||void 0===A?void 0:A.name)&&void 0!==s?s:$}),(0,f.jsx)("p",{className:"text-xs text-scale-1100",children:(0,f.jsxs)("code",{className:"!mx-0",children:["ID: ",null===A||void 0===A?void 0:A.id]})})]})]})})})}),(0,f.jsx)(P.C,{closable:!0,hideFooter:!0,size:"medium",visible:E,onCancel:function(){return V(!1)},header:(0,f.jsx)("h5",{className:"text-sm text-scale-1200",children:"Add a new key"}),children:(0,f.jsx)(Y.Z,{id:"add-new-key-form",validateOnBlur:!1,initialValues:{name:""},validate:function(e){var s={};return 0===e.name.length&&(s.name="Please provide a name for your key"),s},onSubmit:U,children:function(e){var s=e.isSubmitting;return(0,f.jsxs)("div",{className:"py-4",children:[(0,f.jsxs)(P.C.Content,{children:[(0,f.jsx)("p",{className:"text-sm mb-4",children:"Provide a name for your key for easier identification."}),(0,f.jsx)("div",{className:"space-y-4 pb-4",children:(0,f.jsx)(N.Z,{id:"name",label:"Key Name",descriptionText:"Keys are of standard UUID types."})})]}),(0,f.jsx)(P.C.Separator,{}),(0,f.jsx)(P.C.Content,{children:(0,f.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,f.jsx)(u.z,{type:"default",disabled:s,onClick:function(){return V(!1)},children:"Cancel"}),(0,f.jsx)(u.z,{htmlType:"submit",disabled:s,loading:s,children:"Add key"})]})})]})}})})]})}))}}]);
//# sourceMappingURL=113-07ab83bd091f3c8b.js.map